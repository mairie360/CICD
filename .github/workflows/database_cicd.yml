name: Database CI/CD

on:
  workflow_call:
    inputs:
      package_name:
        required: true
        type: string
        description: The name of the package to release
      ref:
        required: true
        type: string
        description: Branch or tag of the CICD repository to checkout
      github_token:
        required: true
        type: string
        description: GitHub token for actions

jobs:
  release-dev:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout CICD repository
        uses: actions/checkout@v4.2.2
        with:
          repository: mairie360/CICD
          ref: ${{ inputs.ref }}

      - name: Run Dev Release Action
        uses: ./.github/actions/database/dev/release
        with:
          package_name: ${{ inputs.package_name }}
          github_token: ${{ inputs.github_token }}

  deploy-dev:
    runs-on: ubuntu-latest
    needs: release-dev
    steps:
      - name: Checkout CICD repository
        uses: actions/checkout@v4.2.2
        with:
          repository: mairie360/CICD
          ref: ${{ inputs.ref }}

      - name: Run Dev Deploy Action
        uses: ./.github/actions/database/dev/deploy
        with:
          package_name: ${{ inputs.package_name }}
          github_token: ${{ inputs.github_token }}

  # release-staging:
  #   runs-on: ubuntu-latest
  #   needs: deploy-dev
  #   steps:
  #     - name: Checkout CICD repository
  #       uses: actions/checkout@v4.2.2
  #       with:
  #         repository: mairie360/CICD
  #         ref: ${{ inputs.ref }}
  #     - uses: ./.github/actions/database/staging/release
  #       with:
  #         package_name: ${{ inputs.package_name }}

  # deploy-staging:
  #   runs-on: ubuntu-latest
  #   needs: release-staging
  #   steps:
  #     - name: Checkout CICD repository
  #       uses: actions/checkout@v4.2.2
  #       with:
  #         repository: mairie360/CICD
  #         ref: ${{ inputs.ref }}
  #     - uses: ./.github/actions/database/staging/deploy
  #       with:
  #         package_name: ${{ inputs.package_name }}

  # release-prod:
  #   runs-on: ubuntu-latest
  #   needs: deploy-staging
  #   steps:
  #     - name: Checkout CICD repository
  #       uses: actions/checkout@v4.2.2
  #       with:
  #         repository: mairie360/CICD
  #         ref: ${{ inputs.ref }}
  #     - uses: ./.github/actions/database/prod/release
  #       with:
  #         package_name: ${{ inputs.package_name }}

  # deploy-prod:
  #   runs-on: ubuntu-latest
  #   needs: release-prod
  #   steps:
  #     - name: Checkout CICD repository
  #       uses: actions/checkout@v4.2.2
  #       with:
  #         repository: mairie360/CICD
  #         ref: ${{ inputs.ref }}
  #     - uses: ./.github/actions/database/prod/deploy
  #       with:
  #         package_name: ${{ inputs.package_name }}
